@base = http://localhost:3001
@singleHostId = user-1
@multiHostId = host-1
@player2Id = player-2
@player3Id = player-3

############################################################
# Single-player vs AI flow
############################################################

### Create single-player game (AI auto-joins)
# @name singleCreate
POST {{base}}/api/game/create
Content-Type: application/json

{
  "hostName": "Tester",
  "hostId": "{{singleHostId}}",
  "initialPrompt": "A quiet village hides a secret.",
  "turnDurationSeconds": 120,
  "maxTurns": 2,
  "maxPlayers": 2,
  "mode": "single"
}

### Get game state (with turns) to confirm prompt and timer
GET {{base}}/api/game/{{singleCreate.response.body.game.id}}?includeTurns=true

### Submit human turn (turn 1)
POST {{base}}/api/game/{{singleCreate.response.body.game.id}}/turn
Content-Type: application/json

{
  "playerName": "Tester",
  "playerId": "{{singleHostId}}",
  "text": "The lantern flickered as the door creaked open."
}

### Poll game state to see AI turn and status
GET {{base}}/api/game/{{singleCreate.response.body.game.id}}?includeTurns=true

############################################################
# Multiplayer flow
############################################################

### Create multiplayer game
# @name multiCreate
POST {{base}}/api/game/create
Content-Type: application/json

{
  "hostName": "Host",
  "hostId": "{{multiHostId}}",
  "turnDurationSeconds": 120,
  "maxTurns": 3,
  "maxPlayers": 3,
  "mode": "multi"
}

### Join as Player 2
POST {{base}}/api/game/{{multiCreate.response.body.game.id}}/join
Content-Type: application/json

{
  "playerName": "Player2",
  "playerId": "{{player2Id}}"
}

### Join as Player 3
POST {{base}}/api/game/{{multiCreate.response.body.game.id}}/join
Content-Type: application/json

{
  "playerName": "Player3",
  "playerId": "{{player3Id}}"
}

### Start game (host only)
POST {{base}}/api/game/{{multiCreate.response.body.game.id}}/start
Content-Type: application/json

{
  "playerId": "{{multiHostId}}"
}

### Host submits turn 1
POST {{base}}/api/game/{{multiCreate.response.body.game.id}}/turn
Content-Type: application/json

{
  "playerName": "Host",
  "playerId": "{{multiHostId}}",
  "text": "Host opens the story."
}

### Player 2 submits turn 2
POST {{base}}/api/game/{{multiCreate.response.body.game.id}}/turn
Content-Type: application/json

{
  "playerName": "Player2",
  "playerId": "{{player2Id}}",
  "text": "Player2 adds a twist."
}

### Player 3 submits turn 3 (should finish)
POST {{base}}/api/game/{{multiCreate.response.body.game.id}}/turn
Content-Type: application/json

{
  "playerName": "Player3",
  "playerId": "{{player3Id}}",
  "text": "Player3 closes the loop."
}

### Get game state with turns and scores
GET {{base}}/api/game/{{multiCreate.response.body.game.id}}?includeTurns=true

### Preview a turn (for any active game)
POST {{base}}/api/game/{{multiCreate.response.body.game.id}}/preview
Content-Type: application/json

{
  "playerName": "Player2",
  "playerId": "{{player2Id}}",
  "text": "A quick sample turn text to get a preview prompt."
}

############################################################
# Lobbies and history
############################################################

### List open lobbies
GET {{base}}/api/game/lobbies

### Fetch recent games for a user (history)
GET {{base}}/api/game/user/{{singleHostId}}/history?limit=5

### Abandon lobby (host only)
POST {{base}}/api/game/{{multiCreate.response.body.game.id}}/abandon
Content-Type: application/json

{
  "playerId": "{{multiHostId}}",
  "reason": "host_left"
}

### Cleanup waiting lobbies (admin)
POST {{base}}/api/game/cleanup-lobbies
Content-Type: application/json

{}
